
const trigger=document.getElementById('description');const header=document.querySelector('.header');const headerLogo=document.querySelector('.header .logo__content');zeitgeber.switchThemes(trigger,header,headerLogo,'/img/t4p-dark.svg','/img/t4p-light.svg','header--light',225);const allImages=Array.from(document.getElementsByClassName('slider__unselected'));const selectedImage=document.querySelector('.slider__display');let isSliding=0;const changeImage=(imageList,imageDisplay,imageIcon)=>{if(isSliding<=2){imageList.forEach(e=>e.classList.remove('slider__selected'));imageIcon.classList.add('slider__selected');imageDisplay.src=imageIcon.src;}}
allImages.forEach(e=>e.addEventListener('click',evt=>{changeImage(allImages,selectedImage,e);}));const zoomImage=document.querySelector('.slider__zoom');const zoomElement=document.querySelector('.purchase__zoom');const toggleOverlay=(overlayContainer)=>{overlayContainer.classList.toggle('purchase__overlay');document.body.classList.toggle('lock');}
selectedImage.addEventListener('click',evt=>{toggleOverlay(zoomElement);zoomImage.src=selectedImage.src;});zoomElement.addEventListener('click',evt=>{toggleOverlay(zoomElement);});const btnCheckOut=document.getElementById('options_send');const buyElement=document.querySelector('.purchase__buy');const btnOverlayCancel=document.querySelector('.order__cancel');const options=document.querySelectorAll('.options__form .options__option');const summaryOptions=document.querySelector('.order__summary .bullets');const orderForm=document.getElementById('order_form');orderForm.addEventListener('submit',async(evt)=>{evt.preventDefault();const inputs=zeitgeber.formatElementsPayload(orderForm,'input','value');const textareas=zeitgeber.formatElementsPayload(orderForm,'textarea','value');const checkedOptions=Array.from(options).filter(option=>option.querySelector('.options__input').checked).map(option=>option.innerText.split('\n')[0]);const productName=document.querySelector('.options__title').innerText;await zeitgeber.sendHttpRequest('POST','/order',{...inputs,...textareas,productName:productName,options:checkedOptions});window.location.href='/';});btnCheckOut.addEventListener('click',evt=>{const checkedOptions=Array.from(options).filter(option=>option.querySelector('.options__input').checked);if(checkedOptions.length===0){return;}
summaryOptions.innerText='';checkedOptions.forEach(option=>{const opt=document.createElement('li');opt.classList.add('bullets__item');opt.innerText=option.innerText.split('\n')[0];summaryOptions.append(opt);});toggleOverlay(buyElement);});btnOverlayCancel.addEventListener('click',evt=>{toggleOverlay(buyElement);});const imagesElement=document.querySelector('.slider__list');const imageSlider=document.querySelector('.slider');let isDown=false;let offsetX=0;let currentPosition=0;let initialPosition=allImages[0].getBoundingClientRect().left;const slideStart=(evt)=>{isDown=true;offsetX=evt.clientX-currentPosition;}
const slideEnd=()=>{isDown=false;let imageWidth=allImages[0].offsetWidth;let currFirstPos=allImages[0].getBoundingClientRect().left;let snapPosition=(currFirstPos>initialPosition)?0:Math.floor((currFirstPos-initialPosition)/imageWidth);if(allImages.length<5){currentPosition=0;}
else if(-snapPosition>allImages.length-5){currentPosition=-(allImages.length-5)*imageWidth;}
else{currentPosition=snapPosition*imageWidth;}
imageSlider.style.transform='translateX('+currentPosition+'px)';setTimeout(()=>{isSliding=0;},100);}
const slideMove=evt=>{if(isDown){isSliding++;imageSlider.style.transform='translateX('+(evt.clientX-offsetX)+'px)';currentPosition=evt.clientX-offsetX;}}
imagesElement.addEventListener('mousedown',evt=>{slideStart(evt);});document.body.addEventListener('mouseup',evt=>{if(isDown&&isSliding)slideEnd();else isDown=false;});document.body.addEventListener('mousemove',evt=>{slideMove(evt);});imagesElement.addEventListener('touchstart',evt=>{let style=imageSlider.getAttribute('style');imageSlider.setAttribute('style',style+'transition: transform 0s ease-in-out;');slideStart(evt.touches[0]);});document.body.addEventListener('touchend',evt=>{if(isDown&&isSliding){let style=imageSlider.getAttribute('style');imageSlider.setAttribute('style',style+'transition: transform 0.2s ease-in-out;');slideEnd();}
else isDown=false;});document.body.addEventListener('touchmove',evt=>{slideMove(evt.touches[0]);});function on_resize(cb,t){onresize=function(){clearTimeout(t);t=setTimeout(cb,100);};return cb;};on_resize(function(){initialPosition=imagesElement.getBoundingClientRect().left+3;slideEnd();})();